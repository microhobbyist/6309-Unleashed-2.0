LISTING FOR LOGIC DESCRIPTION FILE: WaitStateGen.pld                 Page 1

CUPL(WM): Universal Compiler for Programmable Logic
Version 5.0a Serial# MW-10400000
Copyright (c) 1983, 1998 Logical Devices, Inc.
Created Tue Dec 02 06:53:23 2025

  1:Name     WaitStateGen ;
  2:PartNo   ATF750CL ;
  3:Date     2025/11/28 ;
  4:Revision 12 ;
  5:Designer Frederic Segard ;
  6:Company  MicroHobbyist ;
  7:Assembly None ;
  8:Location None ;
  9:Device   v750c ;
 10:
 11:/* =========================================================
 12:   6309 WAIT-STATE STRETCHER (ATF750C VERSION)
 13:   ---------------------------------------------------------
 14:   Supports true 0..3 wait states (WS1..WS0).
 15:   Quarter-cycle timing using CPUclk.
 16:   1 wait state = 4 quarter cycles.
 17:   4-bit down counter CNT3..CNT0 (0..15 range).
 18:   MRDY held low while counter > 0.
 19:   External wait requests OR-in.
 20:   ========================================================= */
 21:
 22:/* ------------------------- INPUTS ------------------------- */
 23:PIN  1 =  CPUclk ;    /* 4x clock from CPU Speed Selector PLD */
 24:PIN  2 =  E ;         /* CPU E */
 25:PIN  3 =  RW ;        /* CPU R/W */
 26:PIN  4 = !RESET ;     /* System reset, active low */
 27:PIN  5 = !MREQ ;      /* Memory Request (only there for Shadow ROM) */
 28:PIN  6 = !VDPWAIT ;   /* VDP wait, active low */
 29:PIN  7 = !PSGDT ;     /* PSG dtack OR, active low */
 30:PIN  8 = !WAIT1 ;     /* External wait 1 */
 31:PIN  9 = !WAIT2 ;     /* External wait 2 */
 32:PIN 10 = !WAIT3 ;     /* External wait 3 */
 33:PIN 11 =  WS0 ;       /* Wait-state bit 0 */
 34:/*  12 =  GND */
 35:PIN 13 =  WS1 ;       /* Wait-state bit 1 */
 36:PIN 14 = !ROMdis ;    /* ROM disable chip select */
 37:
 38:/* ------------------------- OUTPUTS ------------------------ */
 39:/*  24 =  VCC */
 40:PIN 23 = !MRDY ;      /* MRDY to CPU, active low */
 41:PIN 22 =  CNT0 ;      /* NC - Counter bit 0 (debug) */
 42:PIN 21 =  CNT1 ;      /* NC - Counter bit 1 (debug) */
 43:PIN 20 =  CNT2 ;      /* NC - Counter bit 2 (debug) */
 44:PIN 19 =  CNT3 ;      /* NC - Counter bit 3 (debug) */
 45:PIN 18 =  RUN ;       /* NC - Stretch active (debug) */
 46:/*  17 =  NC ;        /* Not connected */
 47:PIN 16 = !ROMcs ;     /* ROM chip select, valid until !ROMdis */
 48:PIN 15 = !RAMoe ;     /* RAM output enable, valid when !ROMdis */
 49:
 50:/* ----------------------- BURIED NODES --------------------- */
 51:
 52:PINNODE 25 = E_prev ;        /* Previous E (synced) */
 53:PINNODE 26 = E_sync ;        /* Synchronized E */

LISTING FOR LOGIC DESCRIPTION FILE: WaitStateGen.pld                 Page 2

CUPL(WM): Universal Compiler for Programmable Logic
Version 5.0a Serial# MW-10400000
Copyright (c) 1983, 1998 Logical Devices, Inc.
Created Tue Dec 02 06:53:23 2025

 54:PINNODE 27 = WAIT_NZ_prev ;  /* Previous WAIT_NZ */
 55:PINNODE 28 = ROMdisFF ;      /* ROM disable */
 56:PINNODE 29 = HOLD ;          /* Hold latch */
 57:
 58:/* =========================================================
 59:                 SHADOW ROM LOGIC
 60:   ========================================================= */
 61:
 62:ROMdisFF.d  = 'b'1 ;
 63:ROMdisFF.ck = ROMdis ;
 64:ROMdisFF.ar = RESET ;
 65:ROMdisFF.sp = 'b'0 ;
 66:
 67:ROMcs  =  !MREQ #  ROMdisFF ;
 68:RAMoe  =  !(RW & E) # !ROMdisFF ;
 69:
 70:/* =========================================================
 71:   E SYNCHRONIZERS (CPUclk DOMAIN)
 72:   ========================================================= */
 73:
 74:E_sync.d  = E ;
 75:E_sync.ck = CPUclk ;
 76:E_sync.ar = RESET ;
 77:E_sync.sp = 'b'0 ;
 78:
 79:E_prev.d  = E_sync ;
 80:E_prev.ck = CPUclk ;
 81:E_prev.ar = RESET ;
 82:E_prev.sp = 'b'0 ;
 83:
 84:/* E rising-edge detect */
 85:E_rise = E_sync & !E_prev ;
 86:
 87:/* Track WAIT_NZ changes */
 88:WAIT_NZ_prev.d  = WAIT_NZ ;
 89:WAIT_NZ_prev.ck = CPUclk ;
 90:WAIT_NZ_prev.ar = RESET ;
 91:WAIT_NZ_prev.sp = 'b'0 ;
 92:
 93:/* Detect when WS value changes during E high */
 94:WAIT_RISE = WAIT_NZ & !WAIT_NZ_prev ;
 95:
 96:/* =========================================================
 97:   EXTERNAL WAIT SOURCES
 98:   ========================================================= */
 99:
100:EXT_WAIT = VDPWAIT # PSGDT # WAIT1 # WAIT2 # WAIT3 ;
101:
102:/* =========================================================
103:   WAIT-STATE VALUE (0..3) AND PRELOAD (WS * 4)
104:   ========================================================= */
105:
106:/* Non-zero WS */
107:WAIT_NZ = WS0 # WS1 ;

LISTING FOR LOGIC DESCRIPTION FILE: WaitStateGen.pld                 Page 3

CUPL(WM): Universal Compiler for Programmable Logic
Version 5.0a Serial# MW-10400000
Copyright (c) 1983, 1998 Logical Devices, Inc.
Created Tue Dec 02 06:53:23 2025

108:
109:/* Preload = WS * 4 (shift left 2 bits) */
110:LOAD0 = 'b'0 ;
111:LOAD1 = 'b'0 ;
112:LOAD2 = WS0 ;
113:LOAD3 = WS1 ;
114:
115:/* =========================================================
116:   RUN CONTROL AND DOWN COUNTER (4 BITS)
117:   ========================================================= */
118:
119:CNT_ZERO = !CNT3 & !CNT2 & !CNT1 & !CNT0 ;
120:
121:/* Load when:
122:   - E rises and WS != 0
123:   - OR WS becomes nonzero while E is high
124:*/
125:LOAD = (E_rise & WAIT_NZ & !RUN) #
126:       (E_sync & WAIT_RISE & !RUN) ;
127:
128:/* RUN while counter not zero */
129:RUN.d  = LOAD # (RUN & !CNT_ZERO) ;
130:RUN.ck = CPUclk ;
131:RUN.ar = RESET ;
132:RUN.sp = 'b'0 ;
133:
134:/* Decrement enable */
135:DEC = RUN & !CNT_ZERO ;
136:
137:/* --------------- 4-bit DOWN COUNTER (CNT3..CNT0) --------------- */
138:
139:CNT0.d = (LOAD & LOAD0) # (!LOAD & (DEC $ CNT0)) ;
140:CNT0.ck = CPUclk ;
141:CNT0.ar = RESET ;
142:CNT0.sp = 'b'0 ;
143:
144:CNT1.d = (LOAD & LOAD1) # (!LOAD & ((DEC & !CNT0) $ CNT1)) ;
145:CNT1.ck = CPUclk ;
146:CNT1.ar = RESET ;
147:CNT1.sp = 'b'0 ;
148:
149:CNT2.d = (LOAD & LOAD2) # (!LOAD & ((DEC & !CNT1 & !CNT0) $ CNT2)) ;
150:CNT2.ck = CPUclk ;
151:CNT2.ar = RESET ;
152:CNT2.sp = 'b'0 ;
153:
154:CNT3.d = (LOAD & LOAD3) # (!LOAD & ((DEC & !CNT2 & !CNT1 & !CNT0) $ CNT3)) ;
155:CNT3.ck = CPUclk ;
156:CNT3.ar = RESET ;
157:CNT3.sp = 'b'0 ;
158:
159:/* =========================================================
160:   OUTPUT
161:   ========================================================= */

LISTING FOR LOGIC DESCRIPTION FILE: WaitStateGen.pld                 Page 4

CUPL(WM): Universal Compiler for Programmable Logic
Version 5.0a Serial# MW-10400000
Copyright (c) 1983, 1998 Logical Devices, Inc.
Created Tue Dec 02 06:53:23 2025

162:
163:MRDY = RUN # EXT_WAIT ;
164:
165:
166:



Jedec Fuse Checksum       (1d7e)
Jedec Transmit Checksum   (6582)
