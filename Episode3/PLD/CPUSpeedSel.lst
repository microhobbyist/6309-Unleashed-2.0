LISTING FOR LOGIC DESCRIPTION FILE: CPUSpeedSel.pld                  Page 1

CUPL(WM): Universal Compiler for Programmable Logic
Version 5.0a Serial# MW-10400000
Copyright (c) 1983, 1998 Logical Devices, Inc.
Created Fri Nov 28 09:00:33 2025

  1:Name     CPUSpeedSel ;
  2:PartNo   ATF750CL ;
  3:Date     2025/11/28 ;
  4:Revision 17 ;
  5:Designer Frederic Segard ;
  6:Company  MicroHobbyist ;
  7:Assembly None ;
  8:Location None ;
  9:Device   v750c ;
 10:
 11:/* INPUTS */
 12:PIN  1 =  CLK4x ;    /* 16 MHz system oscillator */
 13:PIN  2 =  E ;        /* CPU E (from 6309) */
 14:PIN  3 =  RW ;       /* 1=read, 0=write */
 15:PIN  4 = !RESET ;    /* Active-low reset */
 16:PIN  5 = !SPDsel ;   /* Speed Select chip select */
 17:PIN  6 =  BA ;       /* Bus Available */
 18:PIN  7 =  BS ;       /* Bus Status */
 19:PIN  8 = !HALTin ;   /* External halt input */
 20:PIN  9 = !PAUSEsw ;  /* Pause switch (experimental) */
 21:PIN 10 =  S0init ;   /* DIP switch for startup speed bit 0 */
 22:PIN 11 =  S1init ;   /* DIP switch for startup speed bit 1 */
 23:/*  12 =  GND ;      /* Ground */
 24:/*  13 =  GND ;      /* Tied to ground */
 25:
 26:/* OUTPUTS */
 27:/*  24 =  VCC */
 28:PIN 23 =  LED_R ;
 29:PIN 22 =  LED_G ;
 30:PIN 21 =  LED_B ;
 31:PIN 20 = !HALTout ;  /* Halt request to CPU */
 32:PIN 19 =  CPUclk ;   /* Chosen CPU clock speed (pin 38) */
 33:PIN 18 = !RD ;       /* Read signal */
 34:PIN 17 = !WR ;       /* Write signal */
 35:PIN 16 =  CPUstp ;   /* CPU is halted or bus granted - BA/BS = 1 */
 36:
 37:/* BIDIRECTIONAL (Data Bus) */
 38:PIN 15 = D0 ;
 39:PIN 14 = D1 ;
 40:
 41:/* BURIED NODES */
 42:PINNODE 25 = DIV2 ;
 43:PINNODE 26 = DIV4 ;
 44:PINNODE 27 = DIV8 ;
 45:PINNODE 33 = S0 ;
 46:PINNODE 32 = S1 ;
 47:PINNODE 28 = H0 ;
 48:PINNODE 29 = H1 ;
 49:PINNODE 34 = H2 ;
 50:
 51:/* Misc combinatorial logic */
 52:RD     =  RW & E ;
 53:WR     = !RW & E ;

LISTING FOR LOGIC DESCRIPTION FILE: CPUSpeedSel.pld                  Page 2

CUPL(WM): Universal Compiler for Programmable Logic
Version 5.0a Serial# MW-10400000
Copyright (c) 1983, 1998 Logical Devices, Inc.
Created Fri Nov 28 09:00:33 2025

 54:CPUstp =  BA & BS ;  /* LED turns on whenever CPU is stopped */
 55:
 56:/* =========================================================
 57:                   SPEED REGISTER (DIP + E-qualified)
 58:   ---------------------------------------------------------
 59:   ALL flip-flops use the global clock (CLK4x), as required
 60:   by the ATF750C.  Updates occur on E=1 using clock-enable
 61:   logic instead of gated clocks.
 62:========================================================= */
 63:
 64:/* RESET is active-low input, so RESET=0 means "in reset" */
 65:/* DIP switches produce S0init and S1init on pins 10 and 11 */
 66:
 67:REG_WRITE = SPDsel & !RW ;
 68:
 69:/* ---------------------------
 70:   QUALIFIERS
 71:---------------------------- */
 72:
 73:/* Detect when E=1 (sample window) */
 74:E_HIGH = E ;
 75:
 76:/* Default values after reset */
 77:S0_default = S0init ;
 78:S1_default = S1init ;
 79:
 80:/* Next-state equations using clock-enable logic */
 81:S0_next =
 82:    (RESET & S0_default) #                   /* Preload from DIP during reset */
 83:    (!RESET & E_HIGH & REG_WRITE & D0) #     /* Write new bit */
 84:    (!RESET & E_HIGH & !REG_WRITE & S0) #    /* Hold on read cycle while E=1 */
 85:    (!RESET & !E_HIGH & S0);                 /* Hold when E=0 */
 86:
 87:S1_next =
 88:    (RESET & S1_default) #                   /* Preload from DIP during reset */
 89:    (!RESET & E_HIGH & REG_WRITE & D1) #     /* Write new bit */
 90:    (!RESET & E_HIGH & !REG_WRITE & S1) #    /* Hold on read cycle while E=1 */
 91:    (!RESET & !E_HIGH & S1);                 /* Hold when E=0 */
 92:
 93:/* ---------------------------
 94:   FLIP-FLOPS
 95:---------------------------- */
 96:
 97:S0.d  = S0_next ;
 98:S1.d  = S1_next ;
 99:
100:S0.ck = CLK4x ;
101:S1.ck = CLK4x ;
102:
103:S0.ar = 'b'0 ;
104:S1.ar = 'b'0 ;
105:
106:S0.sp = 'b'0 ;
107:S1.sp = 'b'0 ;

LISTING FOR LOGIC DESCRIPTION FILE: CPUSpeedSel.pld                  Page 3

CUPL(WM): Universal Compiler for Programmable Logic
Version 5.0a Serial# MW-10400000
Copyright (c) 1983, 1998 Logical Devices, Inc.
Created Fri Nov 28 09:00:33 2025

108:
109:
110:/* =========================================================
111:                   CLOCK DIVIDERS
112:========================================================= */
113:
114:DIV2.d  = !DIV2 ;
115:DIV4.d  = DIV4 $ DIV2 ;
116:DIV8.d  = DIV8 $ (DIV2 & DIV4) ;
117:
118:DIV2.ck = CLK4x ;
119:DIV4.ck = CLK4x ;
120:DIV8.ck = CLK4x ;
121:
122:DIV2.ar = RESET ;
123:DIV4.ar = RESET ;
124:DIV8.ar = RESET ;
125:
126:DIV2.sp = 'b'0 ;
127:DIV4.sp = 'b'0 ;
128:DIV8.sp = 'b'0 ;
129:
130:/* =========================================================
131:                   SPEED STATES
132:========================================================= */
133:
134:SPD_TURBO  = S1 &  S0 ;
135:SPD_FAST   = S1 & !S0 ;
136:SPD_NORMAL = !S1 & S0 ;
137:SPD_SLOW   = !S1 & !S0 ;
138:
139:/* =========================================================
140:                   RAW CLOCK (MUX BEFORE SAFE HOLD)
141:========================================================= */
142:
143:NEW_CLK =
144:     (SPD_TURBO  & CLK4x) #
145:     (SPD_FAST   & DIV2 ) #
146:     (SPD_NORMAL & DIV4 ) #
147:     (SPD_SLOW   & DIV8 ) ;
148:
149:/* =========================================================
150:                      RGB LED OUTPUTS
151:========================================================= */
152:
153:LED_R = SPD_TURBO # SPD_FAST ;
154:LED_G = SPD_NORMAL # SPD_FAST ;
155:LED_B = SPD_SLOW ;
156:
157:/* =========================================================
158:                        HALT LOGIC
159:========================================================= */
160:
161:CHANGE_S1 = (REG_WRITE &  D1 & !S1) # (REG_WRITE & !D1 &  S1) ;

LISTING FOR LOGIC DESCRIPTION FILE: CPUSpeedSel.pld                  Page 4

CUPL(WM): Universal Compiler for Programmable Logic
Version 5.0a Serial# MW-10400000
Copyright (c) 1983, 1998 Logical Devices, Inc.
Created Fri Nov 28 09:00:33 2025

162:CHANGE_S0 = (REG_WRITE &  D0 & !S0) # (REG_WRITE & !D0 &  S0) ;
163:
164:HALT_ACTIVE = CHANGE_S1 # CHANGE_S0 ;
165:
166:/* 3-cycle stretch for safe switching */
167:
168:H0.d = HALT_ACTIVE ;
169:H1.d = H0 ;
170:H2.d = H1 ;
171:
172:H0.ck = CLK4x ;
173:H1.ck = CLK4x ;
174:H2.ck = CLK4x ;
175:
176:H0.ar = RESET ;
177:H1.ar = RESET ;
178:H2.ar = RESET ;
179:
180:H0.sp = 'b'0 ;
181:H1.sp = 'b'0 ;
182:H2.sp = 'b'0 ;
183:
184:HALT_SPEED_STRETCHED = HALT_ACTIVE # H0 # H1 # H2 ;
185:
186:HALTout = HALTin # PAUSEsw # HALT_SPEED_STRETCHED ;
187:
188:/* =========================================================
189:                SAFE CLOCK SWITCHING (NEW LOGIC)
190:   ---------------------------------------------------------
191:   Only switch clock when HALT=1 AND BA=1 AND BS=1.
192:   Otherwise CPUclk keeps last output (legal feedback).
193:========================================================= */
194:
195:SAFE = HALTout & BA & BS ;
196:
197:/* CUPL-safe high-level gate: */
198:CPUclk = (!SAFE & NEW_CLK) # (SAFE & CPUclk) ;
199:
200:/* =========================================================
201:                     TRI-STATE READBACK LOGIC
202:========================================================= */
203:
204:REG_READ = SPDsel & RW ;
205:
206:D1 = REG_READ & S1 ;
207:D1.oe = REG_READ ;
208:
209:D0 = REG_READ & S0 ;
210:D0.oe = REG_READ ;
211:
212:CPUclk.oe  = 'b'1 ;
213:CPUstp.oe  = 'b'1 ;
214:HALTout.oe = 'b'1 ;
215:LED_B.oe   = 'b'1 ;

LISTING FOR LOGIC DESCRIPTION FILE: CPUSpeedSel.pld                  Page 5

CUPL(WM): Universal Compiler for Programmable Logic
Version 5.0a Serial# MW-10400000
Copyright (c) 1983, 1998 Logical Devices, Inc.
Created Fri Nov 28 09:00:33 2025

216:LED_G.oe   = 'b'1 ;
217:LED_R.oe   = 'b'1 ;
218:RD.oe      = 'b'1 ;
219:WR.oe      = 'b'1 ;
220:



Jedec Fuse Checksum       (1748)
Jedec Transmit Checksum   (45a1)
