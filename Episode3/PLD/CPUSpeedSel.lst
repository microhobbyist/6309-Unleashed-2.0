LISTING FOR LOGIC DESCRIPTION FILE: CPUSpeedSel.pld                  Page 1

CUPL(WM): Universal Compiler for Programmable Logic
Version 5.0a Serial# MW-10400000
Copyright (c) 1983, 1998 Logical Devices, Inc.
Created Sat Nov 29 19:39:23 2025

  1:Name     CPUSpeedSel ;
  2:PartNo   ATF750CL ;
  3:Date     2025/11/28 ;
  4:Revision 17 ;
  5:Designer Frederic Segard ;
  6:Company  MicroHobbyist ;
  7:Assembly None ;
  8:Location None ;
  9:Device   v750c ;
 10:
 11:/* INPUTS */
 12:PIN  1 =  CLK4x ;    /* 16 MHz system oscillator */
 13:PIN  2 =  E ;        /* CPU E (from 6309) */
 14:PIN  3 =  RW ;       /* 1=read, 0=write */
 15:PIN  4 = !RESET ;    /* Active-low reset */
 16:PIN  5 = !SPDsel ;   /* Speed Select chip select */
 17:PIN  6 =  BA ;       /* Bus Available */
 18:PIN  7 =  BS ;       /* Bus Status */
 19:PIN  8 = !HALTin ;   /* External halt input */
 20:PIN  9 = !PAUSEsw ;  /* Pause switch (experimental) */
 21:PIN 10 =  S0init ;   /* DIP switch for startup speed bit 0 */
 22:PIN 11 =  S1init ;   /* DIP switch for startup speed bit 1 */
 23:/*  12 =  GND ;      /* Ground */
 24:/*  13 =  GND ;      /* Tied to ground */
 25:
 26:/* OUTPUTS */
 27:/*  24 =  VCC */
 28:PIN 23 =  LED_R ;
 29:PIN 22 =  LED_G ;
 30:PIN 21 =  LED_B ;
 31:PIN 20 = !HALTout ;  /* Halt request to CPU */
 32:PIN 19 =  CPUclk ;   /* Chosen CPU clock speed (pin 38) */
 33:PIN 18 =  H3 ;       /* No connect (debug) */
 34:/*  17 =  NC ;       /* No connect */
 35:PIN 16 =  CPUstp ;   /* CPU is halted or bus granted - BA/BS = 1 */
 36:
 37:/* BIDIRECTIONAL (Data Bus) */
 38:PIN 15 = D0 ;
 39:PIN 14 = D1 ;
 40:
 41:/* BURIED NODES */
 42:PINNODE 25 = DIV2 ;
 43:PINNODE 26 = DIV4 ;
 44:PINNODE 27 = DIV8 ;
 45:PINNODE 33 = S0 ;
 46:PINNODE 32 = S1 ;
 47:PINNODE 28 = H0 ;
 48:PINNODE 29 = H1 ;
 49:PINNODE 34 = H2 ;
 50:
 51:CPUstp =  BA & BS ;  /* LED turns on whenever CPU is stopped */
 52:
 53:/* =========================================================

LISTING FOR LOGIC DESCRIPTION FILE: CPUSpeedSel.pld                  Page 2

CUPL(WM): Universal Compiler for Programmable Logic
Version 5.0a Serial# MW-10400000
Copyright (c) 1983, 1998 Logical Devices, Inc.
Created Sat Nov 29 19:39:23 2025

 54:                   SPEED REGISTER (DIP + E-qualified)
 55:   ---------------------------------------------------------
 56:   ALL flip-flops use the global clock (CLK4x), as required
 57:   by the ATF750C.  Updates occur on E=1 using clock-enable
 58:   logic instead of gated clocks.
 59:========================================================= */
 60:
 61:/* RESET is active-low input, so RESET=0 means "in reset" */
 62:/* DIP switches produce S0init and S1init on pins 10 and 11 */
 63:
 64:REG_WRITE = SPDsel & !RW ;
 65:
 66:/* Next-state equations using clock-enable logic */
 67:S0_next =
 68:    (RESET & S0init) #                   /* Preload from DIP during reset */
 69:    (!RESET & E & REG_WRITE & D0) #     /* Write new bit */
 70:    (!RESET & E & !REG_WRITE & S0) #    /* Hold on read cycle while E=1 */
 71:    (!RESET & !E & S0);                 /* Hold when E=0 */
 72:
 73:S1_next =
 74:    (RESET & S1init) #                   /* Preload from DIP during reset */
 75:    (!RESET & E & REG_WRITE & D1) #     /* Write new bit */
 76:    (!RESET & E & !REG_WRITE & S1) #    /* Hold on read cycle while E=1 */
 77:    (!RESET & !E & S1);                 /* Hold when E=0 */
 78:
 79:/* ---------------------------
 80:   FLIP-FLOPS
 81:---------------------------- */
 82:
 83:S0.d  = S0_next ;
 84:S1.d  = S1_next ;
 85:
 86:S0.ck = CLK4x ;
 87:S1.ck = CLK4x ;
 88:
 89:S0.ar = 'b'0 ;
 90:S1.ar = 'b'0 ;
 91:
 92:S0.sp = 'b'0 ;
 93:S1.sp = 'b'0 ;
 94:
 95:
 96:/* =========================================================
 97:                   CLOCK DIVIDERS
 98:========================================================= */
 99:
100:DIV2.d  = !DIV2 ;
101:DIV4.d  = DIV4 $ DIV2 ;
102:DIV8.d  = DIV8 $ (DIV2 & DIV4) ;
103:
104:DIV2.ck = CLK4x ;
105:DIV4.ck = CLK4x ;
106:DIV8.ck = CLK4x ;
107:

LISTING FOR LOGIC DESCRIPTION FILE: CPUSpeedSel.pld                  Page 3

CUPL(WM): Universal Compiler for Programmable Logic
Version 5.0a Serial# MW-10400000
Copyright (c) 1983, 1998 Logical Devices, Inc.
Created Sat Nov 29 19:39:23 2025

108:DIV2.ar = RESET ;
109:DIV4.ar = RESET ;
110:DIV8.ar = RESET ;
111:
112:DIV2.sp = 'b'0 ;
113:DIV4.sp = 'b'0 ;
114:DIV8.sp = 'b'0 ;
115:
116:/* =========================================================
117:                   SPEED STATES
118:========================================================= */
119:
120:SPD_TURBO  = S1 &  S0 ;
121:SPD_FAST   = S1 & !S0 ;
122:SPD_NORMAL = !S1 & S0 ;
123:SPD_SLOW   = !S1 & !S0 ;
124:
125:/* =========================================================
126:                   RAW CLOCK (MUX BEFORE SAFE HOLD)
127:========================================================= */
128:
129:NEW_CLK =
130:     (SPD_TURBO  & CLK4x) #
131:     (SPD_FAST   & DIV2 ) #
132:     (SPD_NORMAL & DIV4 ) #
133:     (SPD_SLOW   & DIV8 ) ;
134:
135:/* =========================================================
136:                      RGB LED OUTPUTS
137:========================================================= */
138:
139:LED_R = SPD_TURBO # SPD_FAST ;
140:LED_G = SPD_NORMAL # SPD_FAST ;
141:LED_B = SPD_SLOW ;
142:
143:/* =========================================================
144:                        HALT LOGIC
145:========================================================= */
146:
147:CHANGE_S1 = (REG_WRITE &  D1 & !S1) # (REG_WRITE & !D1 &  S1) ;
148:CHANGE_S0 = (REG_WRITE &  D0 & !S0) # (REG_WRITE & !D0 &  S0) ;
149:
150:HALT_ACTIVE = CHANGE_S1 # CHANGE_S0 ;
151:
152:/* 3-cycle stretch for safe switching */
153:
154:H0.d = HALT_ACTIVE ;
155:H1.d = H0 ;
156:H2.d = H1 ;
157:H3.d = H2 ;
158:
159:H0.ck = CLK4x ;
160:H1.ck = CLK4x ;
161:H2.ck = CLK4x ;

LISTING FOR LOGIC DESCRIPTION FILE: CPUSpeedSel.pld                  Page 4

CUPL(WM): Universal Compiler for Programmable Logic
Version 5.0a Serial# MW-10400000
Copyright (c) 1983, 1998 Logical Devices, Inc.
Created Sat Nov 29 19:39:23 2025

162:H3.ck = CLK4x ;
163:
164:H0.ar = RESET ;
165:H1.ar = RESET ;
166:H2.ar = RESET ;
167:H3.ar = RESET ;
168:
169:H0.sp = 'b'0 ;
170:H1.sp = 'b'0 ;
171:H2.sp = 'b'0 ;
172:H3.sp = 'b'0 ;
173:
174:HALT_SPEED_STRETCHED = HALT_ACTIVE # H0 # H1 # H2 ;
175:
176:HALTout = HALTin # PAUSEsw # HALT_SPEED_STRETCHED ;
177:
178:/* =========================================================
179:                SAFE CLOCK SWITCHING (NEW LOGIC)
180:   ---------------------------------------------------------
181:   Only switch clock when HALT=1 AND BA=1 AND BS=1.
182:   Otherwise CPUclk keeps last output (legal feedback).
183:========================================================= */
184:
185:SAFE = HALTout & BA & BS ;
186:
187:/* CUPL-safe high-level gate: */
188:CPUclk = (!SAFE & NEW_CLK) # (SAFE & CPUclk) ;
189:
190:/* =========================================================
191:                     TRI-STATE READBACK LOGIC
192:========================================================= */
193:
194:REG_READ = SPDsel & RW ;
195:
196:D1 = REG_READ & S1 ;
197:D1.oe = REG_READ ;
198:
199:D0 = REG_READ & S0 ;
200:D0.oe = REG_READ ;
201:
202:CPUclk.oe  = 'b'1 ;
203:CPUstp.oe  = 'b'1 ;
204:HALTout.oe = 'b'1 ;
205:LED_B.oe   = 'b'1 ;
206:LED_G.oe   = 'b'1 ;
207:LED_R.oe   = 'b'1 ;
208:
209:



Jedec Fuse Checksum       (18c4)
Jedec Transmit Checksum   (4d7c)
