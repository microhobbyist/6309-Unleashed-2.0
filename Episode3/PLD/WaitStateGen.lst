LISTING FOR LOGIC DESCRIPTION FILE: WaitStateGen.pld                 Page 1

CUPL(WM): Universal Compiler for Programmable Logic
Version 5.0a Serial# MW-10400000
Copyright (c) 1983, 1998 Logical Devices, Inc.
Created Sun Nov 16 21:42:18 2025

  1:Name     WaitStateGen ;
  2:PartNo   ATF750C ;
  3:Date     2025/11/15 ;
  4:Revision 7 ;
  5:Designer Frederic Segard ;
  6:Company  MicroHobbyist ;
  7:Assembly None ;
  8:Location None ;
  9:Device   v750c ;
 10:
 11:/* =========================================================
 12:   6309 WAIT-STATE STRETCHER (ATF750C VERSION)
 13:   ---------------------------------------------------------
 14:   Supports true 0..7 wait states (WS2..WS0).
 15:   Quarter-cycle timing using CLK4X.
 16:   1 wait state = 4 quarter cycles.
 17:   Preload = WS * 4 = 0..28.
 18:   5-bit down counter (CNT4..CNT0) handles 0..31.
 19:   MRDY held low while counter > 0.
 20:   ========================================================= */
 21:
 22:/* ------------------------- INPUTS ------------------------- */
 23:PIN  1 =  CLK4X ;    /* 4x EXTAL clock input */
 24:PIN  2 =  E ;        /* CPU E */
 25:PIN  3 =  RW ;       /* CPU R W */
 26:PIN  4 = !RESET ;    /* System reset, active low */
 27:PIN  5 = !VDPWAIT ;  /* VDP wait, active low */
 28:PIN  6 = !PSGDT ;    /* PSG dtack OR, active low */
 29:PIN  7 = !WAIT1 ;    /* External wait 1 */
 30:PIN  8 = !WAIT2 ;    /* External wait 2 */
 31:PIN  9 = !WAIT3 ;    /* External wait 3 */
 32:PIN 10 =  WS0 ;      /* Wait state bit 0 */
 33:PIN 11 =  WS1 ;      /* Wait state bit 1 */
 34:/*  12 =  VCC ;      /* Connected to 5V */
 35:PIN 13 =  WS2 ;      /* Wait state bit 2 */
 36:
 37:/* ------------------------- OUTPUTS ------------------------ */
 38:PIN 23 = !MRDY ;     /* MRDY to CPU, active low */
 39:PIN 22 = !RD ;       /* Read pin */
 40:PIN 21 = !WR ;       /* Write pin */
 41:
 42:/* ----------------------- BURIED NODES --------------------- */
 43:PINNODE 31 =  CNT0 ;    /* Counter bit 0 */
 44:PINNODE 36 =  CNT1 ;    /* Counter bit 1 */
 45:PINNODE 37 =  CNT2 ;    /* Counter bit 2 */
 46:PINNODE 35 =  CNT3 ;    /* Counter bit 3 */
 47:PINNODE 29 =  CNT4 ;    /* Counter bit 4 */
 48:PINNODE 30 =  RUN ;     /* Stretch active */
 49:PINNODE 28 =  E_prev ;  /* Previous E (synced) */
 50:PINNODE 32 =  E_sync ;  /* Synchronized E */
 51:
 52:RD =  RW & E ;
 53:WR = !RW & E ;

LISTING FOR LOGIC DESCRIPTION FILE: WaitStateGen.pld                 Page 2

CUPL(WM): Universal Compiler for Programmable Logic
Version 5.0a Serial# MW-10400000
Copyright (c) 1983, 1998 Logical Devices, Inc.
Created Sun Nov 16 21:42:18 2025

 54:
 55:/* =========================================================
 56:   E SYNCHRONIZERS (CLK4X DOMAIN)
 57:   ========================================================= */
 58:
 59:E_sync.d  = E ;
 60:E_sync.ar = RESET ;
 61:E_sync.sp = 'b'0 ;
 62:
 63:E_prev.d  = E_sync ;
 64:E_prev.ar = RESET ;
 65:E_prev.sp = 'b'0 ;
 66:
 67:/* Rising-edge detect */
 68:E_rise = E_sync & !E_prev ;
 69:
 70:/* =========================================================
 71:   EXTERNAL WAIT SOURCES
 72:   ========================================================= */
 73:/* These inputs are active low at the pin. Internal EXT_WAIT is active high. */
 74:
 75:EXT_WAIT = VDPWAIT # PSGDT # WAIT1 # WAIT2 # WAIT3 ;
 76:
 77:/* =========================================================
 78:   WAIT-STATE VALUE (0..7) AND PRELOAD (WS * 4)
 79:   ========================================================= */
 80:
 81:/* Raw WS bits */
 82:WS_NUM0 = WS0 ;
 83:WS_NUM1 = WS1 ;
 84:WS_NUM2 = WS2 ;
 85:
 86:/* Non-zero WS request */
 87:WAIT_NZ = WS_NUM0 # WS_NUM1 # WS_NUM2 ;
 88:
 89:/* Preload = WS * 4 (shift left by two) */
 90:LOAD0 = 'b'0 ;
 91:LOAD1 = 'b'0 ;
 92:LOAD2 = WS_NUM0 ;
 93:LOAD3 = WS_NUM1 ;
 94:LOAD4 = WS_NUM2 ;
 95:
 96:/* =========================================================
 97:   RUN CONTROL AND DOWN COUNTER (5 BITS)
 98:   ========================================================= */
 99:
100:CNT_ZERO = !CNT4 & !CNT3 & !CNT2 & !CNT1 & !CNT0 ;
101:
102:/* Load counter on E rising when WS > 0 and not already running */
103:LOAD = E_rise & WAIT_NZ & !RUN ;
104:
105:/* RUN stays active while counter not zero */
106:RUN.d  = LOAD # (RUN & !CNT_ZERO) ;
107:RUN.ar = RESET ;

LISTING FOR LOGIC DESCRIPTION FILE: WaitStateGen.pld                 Page 3

CUPL(WM): Universal Compiler for Programmable Logic
Version 5.0a Serial# MW-10400000
Copyright (c) 1983, 1998 Logical Devices, Inc.
Created Sun Nov 16 21:42:18 2025

108:RUN.sp = 'b'0 ;
109:
110:/* Decrement when RUN is active */
111:DEC = RUN & !CNT_ZERO ;
112:
113:/* ---------------- 5-bit down counter ---------------------- */
114:
115:CNT0.d = (LOAD & LOAD0) # (!LOAD & (DEC $ CNT0)) ;
116:CNT0.ar = RESET ;
117:CNT0.sp = 'b'0 ;
118:
119:CNT1.d = (LOAD & LOAD1) # (!LOAD & ((DEC & !CNT0) $ CNT1)) ;
120:CNT1.ar = RESET ;
121:CNT1.sp = 'b'0 ;
122:
123:CNT2.d = (LOAD & LOAD2) # (!LOAD & ((DEC & !CNT1 & !CNT0) $ CNT2)) ;
124:CNT2.ar = RESET ;
125:CNT2.sp = 'b'0 ;
126:
127:CNT3.d = (LOAD & LOAD3) # (!LOAD & ((DEC & !CNT2 & !CNT1 & !CNT0) $ CNT3)) ;
128:CNT3.ar = RESET ;
129:CNT3.sp = 'b'0 ;
130:
131:CNT4.d = (LOAD & LOAD4) # (!LOAD & ((DEC & !CNT3 & !CNT2 & !CNT1 & !CNT0) $ CNT4)) ;
132:CNT4.ar = RESET ;
133:CNT4.sp = 'b'0 ;
134:
135:/* =========================================================
136:   OUTPUTS
137:   ========================================================= */
138:
139:MRDY = RUN # EXT_WAIT ;
140:
141:/* =========================================================
142:   END OF FILE
143:   ========================================================= */
144:
145:



Jedec Fuse Checksum       (ae75)
Jedec Transmit Checksum   (5996)
