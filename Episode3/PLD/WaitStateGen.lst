LISTING FOR LOGIC DESCRIPTION FILE: WaitStateGen.pld                 Page 1

CUPL(WM): Universal Compiler for Programmable Logic
Version 5.0a Serial# MW-10400000
Copyright (c) 1983, 1998 Logical Devices, Inc.
Created Sat Nov 22 21:35:25 2025

  1:Name     WaitStateGen ;
  2:PartNo   ATF750C ;
  3:Date     2025/11/22 ;
  4:Revision 8 ;
  5:Designer Frederic Segard ;
  6:Company  MicroHobbyist ;
  7:Assembly None ;
  8:Location None ;
  9:Device   v750c ;
 10:
 11:/* =========================================================
 12:   6309 WAIT-STATE STRETCHER (ATF750C VERSION)
 13:   ---------------------------------------------------------
 14:   Supports true 0..7 wait states (WS2..WS0).
 15:   Quarter-cycle timing using CLK4x.
 16:   1 wait state = 4 quarter cycles.
 17:   Preload = WS * 4 = 0..28.
 18:   5-bit down counter (CNT4..CNT0) handles 0..31.
 19:   MRDY held low while counter > 0.
 20:   ========================================================= */
 21:
 22:/* ------------------------- INPUTS ------------------------- */
 23:PIN  1 =  CLK4x ;    /* 4x EXTAL clock input */
 24:PIN  2 =  E ;        /* CPU E */
 25:PIN  3 =  RW ;       /* CPU R W */
 26:PIN  4 = !RESET ;    /* System reset, active low */
 27:PIN  5 = !VDPWAIT ;  /* VDP wait, active low */
 28:PIN  6 = !PSGDT ;    /* PSG dtack OR, active low */
 29:PIN  7 = !WAIT1 ;    /* External wait 1 */
 30:PIN  8 = !WAIT2 ;    /* External wait 2 */
 31:PIN  9 = !WAIT3 ;    /* External wait 3 */
 32:PIN 10 =  WS0 ;      /* Wait state bit 0 */
 33:PIN 11 =  WS1 ;      /* Wait state bit 1 */
 34:/*  12 =  GND ;      /* Connected to ground */
 35:PIN 13 =  WS2 ;      /* Wait state bit 2 */
 36:
 37:/* ------------------------- OUTPUTS ------------------------ */
 38:/*  24 =  VCC ;      /* Connected to +5V */
 39:PIN 23 = !MRDY ;     /* MRDY to CPU, active low */
 40:PIN 17 =  RUN ;      /* Stretch active (Not enough PT on buried nodes) */
 41:PIN 22 =  CNT0 ;     /* Counter bit 0 (Not enough PT on buried nodes) */
 42:PIN 20 =  CNT1 ;     /* Counter bit 1 (Not enough PT on buried nodes) */
 43:PIN 19 =  CNT2 ;     /* Counter bit 2 (Not enough PT on buried nodes) */
 44:PIN 18 =  CNT3 ;     /* Counter bit 3 (Not enough PT on buried nodes) */
 45:PIN 21  = CNT4 ;     /* Counter bit 4 (Not enough PT on buried nodes) */
 46:
 47:/* ----------------------- BURIED NODES --------------------- */
 48:
 49:PINNODE 25 =  E_prev ;  /* Previous E (synced) */
 50:PINNODE 26 =  E_sync ;  /* Synchronized E */
 51:PINNODE 27 =  WAIT_NZ_prev ;
 52:PINNODE 31 =  HOLD ;
 53:

LISTING FOR LOGIC DESCRIPTION FILE: WaitStateGen.pld                 Page 2

CUPL(WM): Universal Compiler for Programmable Logic
Version 5.0a Serial# MW-10400000
Copyright (c) 1983, 1998 Logical Devices, Inc.
Created Sat Nov 22 21:35:25 2025

 54:/* =========================================================
 55:   E SYNCHRONIZERS (CLK4X DOMAIN)
 56:   ========================================================= */
 57:
 58:E_sync.d  = E ;
 59:E_sync.ck = CLK4x ;
 60:E_sync.ar = RESET ;
 61:E_sync.sp = 'b'0 ;
 62:
 63:E_prev.d  = E_sync ;
 64:E_prev.ck = CLK4x ;
 65:E_prev.ar = RESET ;
 66:E_prev.sp = 'b'0 ;
 67:
 68:/* Rising-edge detect */
 69:E_rise = E_sync & !E_prev ;
 70:
 71:WAIT_NZ_prev.d  = WAIT_NZ ;
 72:WAIT_NZ_prev.ck = CLK4x ;
 73:WAIT_NZ_prev.ar = RESET ;
 74:WAIT_NZ_prev.sp = 'b'0 ;
 75:
 76:WAIT_RISE = WAIT_NZ & !WAIT_NZ_prev ;
 77:
 78:/* =========================================================
 79:   EXTERNAL WAIT SOURCES
 80:   ========================================================= */
 81:
 82:/* These inputs are active low at the pin. Internal EXT_WAIT is active high. */
 83:EXT_WAIT = VDPWAIT # PSGDT # WAIT1 # WAIT2 # WAIT3 ;
 84:
 85:/* =========================================================
 86:   WAIT-STATE VALUE (0..7) AND PRELOAD (WS * 4)
 87:   ========================================================= */
 88:
 89:/* Raw WS bits */
 90:WS_NUM0 = WS0 ;
 91:WS_NUM1 = WS1 ;
 92:WS_NUM2 = WS2 ;
 93:
 94:/* Non-zero WS request */
 95:WAIT_NZ = WS_NUM0 # WS_NUM1 # WS_NUM2 ;
 96:
 97:/* Preload = WS * 4 (shift left by two) */
 98:LOAD0 = 'b'0 ;
 99:LOAD1 = 'b'0 ;
100:LOAD2 = WS_NUM0 ;
101:LOAD3 = WS_NUM1 ;
102:LOAD4 = WS_NUM2 ;
103:
104:/* =========================================================
105:   RUN CONTROL AND DOWN COUNTER (5 BITS)
106:   ========================================================= */
107:

LISTING FOR LOGIC DESCRIPTION FILE: WaitStateGen.pld                 Page 3

CUPL(WM): Universal Compiler for Programmable Logic
Version 5.0a Serial# MW-10400000
Copyright (c) 1983, 1998 Logical Devices, Inc.
Created Sat Nov 22 21:35:25 2025

108:CNT_ZERO = !CNT4 & !CNT3 & !CNT2 & !CNT1 & !CNT0 ;
109:
110:LOAD = (E_rise  & WAIT_NZ & !RUN) #
111:       (E_sync  & WAIT_RISE & !RUN) ;
112:
113:/* RUN stays active while counter not zero */
114:RUN.d  = LOAD # (RUN & !CNT_ZERO) ;
115:RUN.ck = CLK4x ;
116:RUN.ar = RESET ;
117:RUN.sp = 'b'0 ;
118:
119:/* Decrement when RUN is active */
120:DEC = RUN & !CNT_ZERO ;
121:
122:/* ---------------- 5-bit down counter ---------------------- */
123:
124:CNT0.d = (LOAD & LOAD0) # (!LOAD & (DEC $ CNT0)) ;
125:CNT0.ck = CLK4x ;
126:CNT0.ar = RESET ;
127:CNT0.sp = 'b'0 ;
128:
129:CNT1.d = (LOAD & LOAD1) # (!LOAD & ((DEC & !CNT0) $ CNT1)) ;
130:CNT1.ck = CLK4x ;
131:CNT1.ar = RESET ;
132:CNT1.sp = 'b'0 ;
133:
134:CNT2.d = (LOAD & LOAD2) # (!LOAD & ((DEC & !CNT1 & !CNT0) $ CNT2)) ;
135:CNT2.ck = CLK4x ;
136:CNT2.ar = RESET ;
137:CNT2.sp = 'b'0 ;
138:
139:CNT3.d = (LOAD & LOAD3) # (!LOAD & ((DEC & !CNT2 & !CNT1 & !CNT0) $ CNT3)) ;
140:CNT3.ck = CLK4x ;
141:CNT3.ar = RESET ;
142:CNT3.sp = 'b'0 ;
143:
144:CNT4.d  =(LOAD & LOAD4) # (!LOAD & ((DEC & !CNT3 & !CNT2 & !CNT1 & !CNT0) $ CNT4)) ;
145:CNT4.ck = CLK4x ;
146:CNT4.ar = RESET ;
147:CNT4.sp = 'b'0 ;
148:
149:/* =========================================================
150:   HOLD LATCH TO EXTEND MRDY THROUGH END OF CYCLE
151:   ========================================================= */
152:
153:HOLD.d  = RUN # (HOLD & !E_rise) ;
154:HOLD.ck = CLK4x ;
155:HOLD.ar = RESET ;
156:HOLD.sp = 'b'0 ;
157:
158:/* =========================================================
159:   OUTPUTS
160:   ========================================================= */
161:

LISTING FOR LOGIC DESCRIPTION FILE: WaitStateGen.pld                 Page 4

CUPL(WM): Universal Compiler for Programmable Logic
Version 5.0a Serial# MW-10400000
Copyright (c) 1983, 1998 Logical Devices, Inc.
Created Sat Nov 22 21:35:25 2025

162:/* Internal busy=1 -> pin !MRDY low when busy. */
163:MRDY = HOLD # EXT_WAIT ;
164:
165:
166:



Jedec Fuse Checksum       (aec3)
Jedec Transmit Checksum   (830e)
